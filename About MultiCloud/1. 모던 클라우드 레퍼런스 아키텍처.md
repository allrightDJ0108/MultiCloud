# 모던 클라우드 레퍼런스 아키텍처

- Monolithic Architecture
    - 서비스를 이루고 있는 전체 기능을 단 하나의 코드 베이스로 개발
    - 단일 통합 데이터베이스를 사용
    - 기존 프레임워크 의존성 증가, 기능이 많아지고 규모가 커져 복잡해질수록 CI/CD 및 유지보수 어려움
    - SPOF(Single Point Of Failure), 한가지 기능 장애 발생 시 전체 서비스 장애 및 불가
    - Monolithic 구조 기반 Service의 장애 영향도와 규모에 따른 개발 및 배포 어려움
    
- Microservice Architecture
    - Microservice의 정의
        - Service oriented architecture compose of loosely coupled elements that have bounded contexts
        - 컴포넌트는 장애가 발생해도 서비스는 장애가 발생하지 않도록!
    - Microservice의 구성원칙
        - 단일 책임의 원칙
            - 각 서비스는 하나의 책임만 갖는다.
        - 독립적인 배포 Independently deployable
            - 각각의 서비스들을 독립적으로 배포할 수 있다.
        - 느슨한 결합 Loosely Coupled
            - 각 서비스 간 의존성을 최소화하며, 서비스 간 통신은 각 서비스별 API를 참조한다.
        - 높은 유지성, 테스트 가능성 Highly maintanance and testable
            - 분리된 서비스별 관리 및 유지하기 편하고 테스트도 독립적으로 가능하다.
        - 팀 단위 구성 가능 Owned by a small team
            - 서비스 단위로 팀 구성을 하여 개발/운영이 가능하다.
        - 사업 단위의 조직 Organized around business capabilities
            - 각 서비스의 단위를 사업의 단위로 판단할 수 있다.
        
- Cloud Native
    - 클라우드의 이점을 극대화하는 방법론들을 망라하여 클라우드 네이티브라 정의
        - CI/CD
        - DevOps
        - Microservices
        - Containers
    - 주요 특징으로는 이전에 다룬 MSA 외 CI/CD(지속적 통합과 배포), DevOps(개발과 운영의 일치), 컨테이너 기술 등이 있으며 이들이 유기적으로 돌아갈 수 있도록 구성하는 것을 Cloud Native라고 함
    - 각각이 세부적인 기술 모두 개별적으로 이해하고 구현하는데 많은 시간을 요하지만, 현업 프로젝트에서 전반적으로 Cloud Native라는 이야기를 흔하게 통칭.
    
- DevOps와 CI/CD
    - DevOps는 개발과 운영이 유기적으로 하나로 돌아가도록 말하는 현상
    - 지속적인 피드백을 바로 반영, 개발 후 반영해 대응력을 높이고, 빠른 신기능 추가 및 개선을 할 수 있는 환경 의미
    - CI/CD는 지속적인 통합과 지속적인 배포를 의미하며, DevOps 환경을 구성해 빠르게 개선되는 코드가 지속적으로 통합되고 배포될 수 있도록 함을 의미
    - 이런 모든 특징은 변화에 빠르게 대응하려는 요구사항과 맞닿아 있으며, 이를 지원하기 위한 기반 환경에 클라우드가 갖는 장점들이 반영되어 있음.
- Two Pizza Team
    
    ![Untitled](%E1%84%86%E1%85%A9%E1%84%83%E1%85%A5%E1%86%AB%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A1%E1%84%8B%E1%85%AE%E1%84%83%E1%85%B3%20%E1%84%85%E1%85%A6%E1%84%91%E1%85%A5%E1%84%85%E1%85%A5%E1%86%AB%E1%84%89%E1%85%B3%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%20110197e734e244caa3775029180a62a5/Untitled.png)
    
    - 목적형 조직
    - 한 팀이 마이크로서비스 앱의 기능을 모두 수행할 수 있는 인력을 보유하고 있는 ‘분대’느낌
    - Cloud Native 트렌드와 더불어 DevOps, CI/CD를 구성하기 위한 핵심적 요소
    - 오너십과 책임감을 갖고 서비스를 운영하는 형태
    - 서비스의 DevOps
    

최근 트렌드를 극단적으로 바라보면, 다음과 같이 구성됨

- CI/CD 파이프라인 연계
- 자동화된 테스트, 배포, QA(이를 위한 클라우드, 컨테이너)
- 자동화된 티켓팅 시스템
- MSA 조직 형태로 운영

단, 현실에서는 적절한 수준의 기술을 차용하는 전략이 더욱 적합한 경우가 많음.

- DevOps의 현재
    - 한 서비스가 Two Pizza Team으로 꼭 구성되지 않는 경우가 많고, 복잡한 과정을 자동화하다 보니 툴과 서비스로 도배되곤 함.
    - 어떤 형태를 클라우드 환경에서는 적용하고 있음
    - 그러나 전통적인 조직구조를 가져가는 경우, MSA 구성 등 쉽지 않은 경우 발생
    - 이런 상황에서 여전히 서비스 조직과 인프라 조직이 구분되어 근래에 SRE(Site Reliability Engineering) 직군이 새로 등장
        
        ![Untitled](%E1%84%86%E1%85%A9%E1%84%83%E1%85%A5%E1%86%AB%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A1%E1%84%8B%E1%85%AE%E1%84%83%E1%85%B3%20%E1%84%85%E1%85%A6%E1%84%91%E1%85%A5%E1%84%85%E1%85%A5%E1%86%AB%E1%84%89%E1%85%B3%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%20110197e734e244caa3775029180a62a5/Untitled%201.png)
        

- SRE : Site Reliability Engineering
    - 애플리케이션을 빌드하고 유연하게 배포하고, 이를 모니터링하는 플랫폼
    - 이러한 플랫폼 위에서 개발자들이 스스로 배포, 운영하도록 하는 것이 목표
    - 즉 SRE는 DevOps를 현실적으로 반영 가능하게 하기 위한 가이드
    

# 기업용 클라우드 골든이미지 관리 방안

- 골든이미지의 필요성
    - 각 회사에 표준 솔루션 존재
        - 보안 솔루션 등
    - 클라우드 전에도 있었던 형태로 클라우드도 이를 활용
    - 클라우드에는 머신 이미지(AMI 등) 와 연계할 수 있는 형태로 활용
    - 멀티클라우드 환경으로 확장하기 위해 이를 지원하는 솔루션들이 존재하며 대표적으로 Packer가 존재
        - Packer : 가상의 골드 이미지 생성 시 AWS, 구글 등으로 바꿀 수 있음

- Packer 클라우드 이미지 통합 관리
    - 사용 편의성
        - HCL을 사용, 테라폼과 손쉬운 연동
    - 확장성
        - 사용 환경과 무관하게 다닝 ㄹ언어로 이미지 관리, 타 구성 관리 도구와 연계
    - 오픈소스
        - 기존 오픈 소스 커뮤니티 템플릿을 활용 및 직접 작성
    - 핵심기능
        - Builder
            - 다양한 클라우드 및 온프리미엄 인프라에 대한 이미지 생성 담당
        - Provisioner
            - 기본 제공 소프트웨어 및 타사 소프트웨어 사용, 이미지를 설치하고 구성할 수 있도록 시스템 준비
        - Post Processor
            - 이미지를 만든 후 실행. 아티팩트를 업로드하거나 다시 패키지
        - Data Source
            - 구성에 사용하기 위해 외부 데이터 사용

### “표준화”, “자동화”를 위한 “코드화”

### 골든 이미지를 변경하면, 다운 스트림빌드 전체가 업데이트

- 회사 내에 미리 정의되어야 할 것들
    - 어떤 것이 ‘골드’ 이미지고 어떤 버전을 사용해야 하는가?
    - 이미지 하드닝, 보안 규칙 준누를 위한 이상적인 워크플로우는?
    - 클라우드 전반에 걸쳐 복제 가능?
    - 현재 프로비저닝 워크플로우에 이 프로세스를 통합할 수 있는가?

- Packer를 활용한 골든이미지
    - 가시성 확보
        - 베이스 이미지 다운스트림 빌드와 관련된 배포 파이프 라인에 대한 가시성 확보
    - 자동화된 업데이트
        - 빌드나 배포를 트리거
    - 운영 표준 및 내부 규정에 부합하는 이미지 생성 워크 플로우
        - 사용중인 인프라 전반에 걸친 워크플로우
        
- HCP Packer를 통한 빌드 관리 자동화

![Untitled](%E1%84%86%E1%85%A9%E1%84%83%E1%85%A5%E1%86%AB%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A1%E1%84%8B%E1%85%AE%E1%84%83%E1%85%B3%20%E1%84%85%E1%85%A6%E1%84%91%E1%85%A5%E1%84%85%E1%85%A5%E1%86%AB%E1%84%89%E1%85%B3%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%20110197e734e244caa3775029180a62a5/Untitled%202.png)

# Packer를 활용한 골든이미지 생성 및 관리

```bash
keaOrg

organization ID
77d44ff6-4787-4c9c-9eb2-fed4f353a81d

project ID
756524d0-4576-4129-8ea8-91220296a030

HCP
LuBplDgvh5GXVAANCJYMb6XroLB8ew5f

Bb8eWcVzPgdYRgBOvi---FabE4hBdonoNkcN9m6LX7CzV5Rp1HjeHabs2_kXItmA

Terraform API Key
JzDdzVzpje1GeA.atlasv1.XV5pzOzih9E1NURiICVzzmyUvx7bFRjXoY7wBL56AVDUSV9zq6yAyyEooxpRWVAsSbM

3번
기관명 내껄로 바꾸기
패스패커는 유지
hcp 버전을 바꿔줘야 함
안바꾸면 키 인증에 실패한다
버전을 7.7로 바꾼다

4번
테라폼 들어가서 테라폼 키를 입력해줘야 로그인이 가능
```

![Untitled](%E1%84%86%E1%85%A9%E1%84%83%E1%85%A5%E1%86%AB%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A1%E1%84%8B%E1%85%AE%E1%84%83%E1%85%B3%20%E1%84%85%E1%85%A6%E1%84%91%E1%85%A5%E1%84%85%E1%85%A5%E1%86%AB%E1%84%89%E1%85%B3%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%20110197e734e244caa3775029180a62a5/Untitled%203.png)

## Hashicorp

[https://www.hashicorp.com/cloud](https://www.hashicorp.com/cloud)

- terraform
    - VM을 클릭으로 만들다가 다수 개에 한계를 느껴 개발한 것
- Packer
    - 플러그인, 빌드, 소스로 동작을 한다
